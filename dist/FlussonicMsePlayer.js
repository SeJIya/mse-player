!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FlussonicMsePlayer=t():e.FlussonicMsePlayer=t()}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=15)}([function(e,t){var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(e,t){var r=e.exports={version:"2.6.4"};"number"==typeof __e&&(__e=r)},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logger=t.enableLogs=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=r(52);function i(){}var s={trace:i,debug:i,log:i,warn:i,info:i,error:i},a=s;var u=(0,o.getSelfScope)();function c(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];r.forEach(function(t){var r,n;a[t]=e[t]?e[t].bind(e):(r=t,(n=u.console[r])?function(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];t[0]&&(t[0]=function(e,t){return t="["+e+"] > "+t}(r,t[0])),n.apply(u.console,t)}:i)})}t.enableLogs=function(e){if(!0===e||"object"===(void 0===e?"undefined":n(e))){c(e,"debug","log","info","warn","error");try{a.log()}catch(e){a=s}}else a=s},t.logger=a},function(e,t,r){var n=r(21),o=r(26);e.exports=r(5)?function(e,t,r){return n.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){e.exports=!r(7)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={MEDIA_SOURCE_SOURCE_OPEN:"sourceopen",MEDIA_SOURCE_SOURCE_ENDED:"sourceended",MEDIA_SOURCE_SOURCE_CLOSE:"sourceclose",MEDIA_ELEMENT_PROGRESS:"progress",MEDIA_ELEMENT_EMPTIED:"emptied",WS_OPEN:"open",WS_MESSAGE:"message",WS_ERROR:"error",WS_CLOSE:"close",BUFFER_UPDATE_END:"updateend",BUFFER_ERROR:"onerror",BUFFER_ABORT:"onabort"},e.exports=t.default},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){var r=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+n).toString(36))}},function(e,t,r){var n=r(1),o=r(0),i="__core-js_shared__",s=o[i]||(o[i]={});(e.exports=function(e,t){return s[e]||(s[e]=void 0!==t?t:{})})("versions",[]).push({version:n.version,mode:r(30)?"pure":"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t,r){var n=r(31);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,o){return e.call(t,r,n,o)}}return function(){return e.apply(t,arguments)}}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){var n=r(9)("wks"),o=r(8),i=r(0).Symbol,s="function"==typeof i;(e.exports=function(e){return n[e]||(n[e]=s&&i[e]||(s?i:o)("Symbol."+e))}).store=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorMsg=t.replaceHttpByWS=t.checkVideoProgress=t.MAX_DELAY=void 0,t.getMediaSource=o,t.isAndroid=i,t.isSupportedMSE=function(){if(i())return!1;var e=o(),t=window.SourceBuffer||window.WebKitSourceBuffer,r=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.4d401f,mp4a.40.2"'),n=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!r&&!!n},t.base64ToArrayBuffer=function(e){return Uint8Array.from(atob(e),function(e){return e.charCodeAt(0)})},t.RawDataToUint8Array=s,t.getTrackId=a,t.getRealUtcFromData=u,t.doArrayBuffer=function(){var e=this.segments.shift();e.isInit||(this.utc=u(e.data),this.lastLoadedUTC=this.utc);this.maybeAppend(e)},t.debugData=c,t.pad2=p,t.humanTime=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!(e>0))return"";var r=e,n=new Date;n.setTime(1e3*r);var o=!(!1===t),i=o?n.getHours():n.getUTCHours(),s=o?n.getMinutes():n.getUTCMinutes(),a=o?n.getSeconds():n.getUTCSeconds();return p(i)+":"+p(s)+":"+p(a)},t.logDM=function(e,t){t&&n.logger.log("%c "+t.type+" "+("event"===t.type?t.event:"mse_init_segment"),"background: aquamarine;",t)},t.showDispatchError=function(e,t){var r=e.data instanceof ArrayBuffer;console.error(l(e),t),this.media&&this.media.error&&console.error("MediaError:",this.media.error);r&&console.error("Data:",c(e.data));++d>=this.opts.errorsBeforeStop&&(d=0,this.stopPromise=this.stop());this.onError&&this.onError(t,e)};var n=r(3);function o(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}function i(){return-1!==navigator.userAgent.indexOf("Android")}function s(e){return new Uint8Array(e)}function a(e){return e[47]}function u(e){return(e[92]<<24|e[93]<<16|e[94]<<8|e[95])+(e[96]<<24|e[97]<<16|e[98]<<8|e[99])/1e6}function c(e){var t=s(e);return{trackId:a(t),utc:u(t),view:t}}var h=navigator.userAgent,f=t.MAX_DELAY=/Edge/.test(h)||/trident.*rv:1\d/i.test(h)?10:2,l=(t.checkVideoProgress=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f;return function(o){var i=e.currentTime,s=e.buffered,a=e.buffered.length;if(a){var u=s.end(a-1),c=Math.abs(u-i);t._stalling&&(t.onEndStalling(),e.paused&&t._pause&&!t.playing&&(e.currentTime=u-1e-4,t.playPromise=e.play(),t.playPromise.then(function(){t._pause=!1,t.playing=!0}))),c<=r||(n.logger.log("nudge",i,"->",a?u:"-",i-u),e.currentTime=u-.2)}}},t.replaceHttpByWS=function(e){return e.replace(/^http/,"ws")},t.errorMsg=function(e){return"Error "+e.name+": "+e.message+"\n"+e.stack});function p(e){return e<=9?"0"+e:""+e}var d=0},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.VIDEO="video",t.AUDIO="audio"},function(e,t,r){e.exports=r(16)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(17));t.default=n.default,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();r(18);var i=p(r(42)),s=p(r(53)),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(13)),u=r(3),c=r(54),h=r(14),f=p(r(6)),l=p(r(55));function p(e){return e&&e.__esModule?e:{default:e}}var d=h.VIDEO,m=h.AUDIO,g=1,v=100,y=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n.debug&&((0,u.enableLogs)(!0),window.humanTime=a.humanTime),u.logger.info("[mse-player]:",e.version),this.opts=n||{},this.media=t,this.url=r,this.opts.progressUpdateTime=this.opts.progressUpdateTime||v,this.opts.errorsBeforeStop=this.opts.errorsBeforeStop?this.opts.errorsBeforeStop:g,"number"!=typeof this.opts.errorsBeforeStop||isNaN(this.opts.errorsBeforeStop))throw new Error("invalid errorsBeforeStop param, should be number");this.onProgress=n&&n.onProgress,this.onMediaInfo=n&&n.onMediaInfo,this.onError=n&&n.onError,this.init(),t instanceof HTMLMediaElement&&this.onAttachMedia({media:t}),this.ws=new i.default({message:this.dispatchMessage.bind(this),error:this.onError}),this.sb=new s.default({media:t})}return e.replaceHttpByWS=function(e){return a.replaceHttpByWS(e)},e.isSupported=function(){return a.isSupportedMSE()},o(e,null,[{key:"version",get:function(){return"18.09.3"}}]),e.prototype.play=function(e,t,r){return u.logger.log("[mse-player]: play()"),this._play(e,t,r)},e.prototype.stop=function(){return this.onMediaDetaching()},e.prototype.seek=function e(t){try{if(!t)throw new Error('utc should be "live" or UTC value');this.ws.seek(t),this.sb.seek(),this.onStartStalling(),this.seekValue=t,this.media.pause(),this._pause=!0,this.playing=!1}catch(e){u.logger.warn("seek:"+e.message)}},e.prototype.pause=function(){if(!function(){if(this._pause||!this.media||!this.ws||!this.mediaSource||this.mediaSource&&"open"!==this.mediaSource.readyState||!this.playPromise)return!1;return!0}.bind(this)())return u.logger.log("[mse:playback] can not do pause");var e=function(){if(this.ws.pause(),this.media.pause(),this._pause=!0,this.playing=!1,this.onPause)try{this.onPause()}catch(e){console.error("Error "+e.name+":"+e.message+"\n"+e.stack)}}.bind(this);this.playPromise.then(e,e)},e.prototype.setTracks=function(e){var t=this;if(this.mediaInfo){Array.isArray(e)||console.error('tracks should be an Array instance: ["v1", "a1"]');var r=e.filter(function(e){var r=t.mediaInfo.streams.find(function(t){return e===t.track_id});return!!r&&r.content===d}).join(""),n=e.filter(function(e){var r=t.mediaInfo.streams.find(function(t){return e===t.track_id});return!!r&&r.content===m}).join("");this.onStartStalling(),this.ws.setTracks(r,n),this.videoTrack=r,this.audioTrack=n,this._setTracksFlag=!0,this.waitForInitFrame=!0}else u.logger.warn("Media info did not loaded. Should try after onMediaInfo triggered or inside.")},e.prototype._play=function(e,t,r){var n=this;return new Promise(function(o,i){if(u.logger.log("_play",e,t,r),n.playing){var s="[mse-player] _play: terminate because already has been playing";return u.logger.log(s),o({message:s})}return n._pause?(n._resume(),n._pause=!1,n.playing=!0,n.playPromise=n.media.play(),u.logger.log("_play: terminate because _paused and should resume"),n.playPromise):(n.playTime=e,n.videoTrack=t,n.audioTack=r,n._pause=!1,n.mediaSource?n.mediaSource&&"open"!==n.mediaSource.readyState?(u.logger.warn('readyState is not "open"'),n.shouldPlay=!0,n.resolveThenMediaSourceOpen=n.resolveThenMediaSourceOpen?n.resolveThenMediaSourceOpen:o,void(n.rejectThenMediaSourceOpen=n.rejectThenMediaSourceOpen?n.rejectThenMediaSourceOpen:i)):(n.ws.start(n.url,n.playTime,n.videoTrack,n.audioTack),n.playPromise=n.media.play(),n.startProgressTimer(),n.playPromise.then(function(){n.onStartStalling(),n.resolveThenMediaSourceOpen&&(n.playing=!0,n.resolveThenMediaSourceOpen(),n.resolveThenMediaSourceOpen=void 0,n.rejectThenMediaSourceOpen=void 0)},function(){u.logger.log("playPromise rejection. this.playing false"),n.ws.connectionPromise&&n.ws.connectionPromise.then(function(){return n.ws.pause()}),n._pause=!0,n.playing=!1,n.onError&&n.onError({error:"play_promise_reject"}),n.rejectThenMediaSourceOpen&&(n.rejectThenMediaSourceOpen(),n.resolveThenMediaSourceOpen=void 0,n.rejectThenMediaSourceOpen=void 0)}),n.playPromise):(n.onAttachMedia({media:n.media}),n.onsoa=n._play.bind(n,e,t,r),n.mediaSource.addEventListener(f.default.MEDIA_SOURCE_SOURCE_OPEN,n.onsoa),u.logger.warn("mediaSource did not create"),n.resolveThenMediaSourceOpen=n.resolveThenMediaSourceOpen?n.resolveThenMediaSourceOpen:o,void(n.rejectThenMediaSourceOpen=n.rejectThenMediaSourceOpen?n.rejectThenMediaSourceOpen:i)))})},e.prototype.init=function(){this._pause=!1,this.playing=!1,this.shouldPlay=!1,this.playTime=void 0,this.audioTack="",this.videoTrack="",this.endProgressTimer()},e.prototype._resume=function(){this.ws.resume()},e.prototype.onMediaDetaching=function(){if(!this.stopRunning)return this.stopRunning=!0,this.handlerMediaDetaching();u.logger.warn("stop is running.")},e.prototype.handlerMediaDetaching=function(){var e=this;u.logger.info("media source detaching");var t=void 0;return this.removeMediaSource(),this.media&&(this.media.removeEventListener(f.default.MEDIA_ELEMENT_PROGRESS,this.oncvp),(t=new Promise(function(t){e._onmee=e.onMediaElementEmptied(t).bind(e)})).then(function(){return e.stopRunning=!1}),this.media.addEventListener(f.default.MEDIA_ELEMENT_EMPTIED,this._onmee)),this.oncvp=null,this.mediaSource=null,this.init(),this.ws.destroy(),this.sb.destroy(),t},e.prototype.removeMediaSource=function e(){var t=this.mediaSource;if(t){if("open"===t.readyState)try{t.endOfStream()}catch(e){u.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}t.removeEventListener(f.default.MEDIA_SOURCE_SOURCE_OPEN,this.onmso),t.removeEventListener(f.default.MEDIA_SOURCE_SOURCE_ENDED,this.onmse),t.removeEventListener(f.default.MEDIA_SOURCE_SOURCE_CLOSE,this.onmsc),this.onmso=null,this.onmse=null,this.onmsc=null}URL.revokeObjectURL(this.media.src),this.media.removeAttribute("src"),this.media.load()},e.prototype.onMediaElementEmptied=function(e){return this._onmee&&this.media&&(this.media.removeEventListener(f.default.MEDIA_ELEMENT_EMPTIED,this._onmee),this._onmee=void 0),e()},e.prototype.onAttachMedia=function(e){var t=this;this.media=e.media;var r=this.media;if(!(r instanceof HTMLMediaElement))throw new Error(l.default.NOT_HTML_MEDIA_ELEMENT);if(r){var n=this.mediaSource=new MediaSource;return this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),n.addEventListener(f.default.MEDIA_SOURCE_SOURCE_ENDED,this.onmse),n.addEventListener(f.default.MEDIA_SOURCE_SOURCE_CLOSE,this.onmsc),r.src=URL.createObjectURL(n),this.oncvp=a.checkVideoProgress(r,this).bind(this),this.media.addEventListener(f.default.MEDIA_ELEMENT_PROGRESS,this.oncvp),new Promise(function(e){t.onmso=t.onMediaSourceOpen.bind(t,e),n.addEventListener(f.default.MEDIA_SOURCE_SOURCE_OPEN,t.onmso)})}},e.prototype.onMediaSourceOpen=function(e){e();var t=this.mediaSource;t&&t.removeEventListener(f.default.MEDIA_SOURCE_SOURCE_OPEN,this.onmso),this.shouldPlay&&(u.logger.info("readyState now is "+this.mediaSource.readyState+", and will be played",this.playTime,this.audioTack,this.videoTrack),this.shouldPlay=!1,this._play(this.playTime,this.audioTack,this.videoTrack))},e.prototype.dispatchMessage=function e(t){if(!this.stopRunning){var r=t.data,n=r instanceof ArrayBuffer,o=n?void 0:JSON.parse(r);a.logDM(n,o);try{if(n){if(this.waitForInitFrame)return u.logger.log("old frames");this.sb.procArrayBuffer(r)}if(o&&o.type===c.EVENT_SEGMENT){var i=o[c.EVENT_SEGMENT];switch(i){case"resumed":this._pause&&!this.playing&&this.onStartStalling();break;case"paused":break;case"seeked":case"switched_to_live":if(this.seekValue=void 0,this.opts.onSeeked)try{this.opts.onSeeked()}catch(e){console.error(e)}break;case"recordings_ended":this._eos=!0,this.sb.onBufferEos();break;case"stream_unavailable":var s={error:"no_live",event:i};throw u.logger.log("do playPromise reject with error",s),new Error(s);default:this.opts.onError&&this.opts.onError({error:"unhandled_event",event:i}),u.logger.warn("unknown type of event",i)}return}if(o&&o.type===c.MSE_INIT_SEGMENT)return this.procInitSegment(r)}catch(e){this.ws.pause(),a.showDispatchError.bind(this)(t,e)}}},e.prototype.procInitSegment=function(e){var t=JSON.parse(e);if(t.type!==c.MSE_INIT_SEGMENT)return u.logger.warn("type is not "+c.MSE_INIT_SEGMENT);if(this.waitForInitFrame&&(this.waitForInitFrame=!1),this.sb.isBuffered()){this.media.pause(),this.previouslyPaused=!1,this._setTracksFlag=!0,this.immediateSwitch=!0;this.sb.flushRange.push({start:0,end:1/0,type:void 0}),this.sb.flushBufferCounter=0,this.sb.doFlush()}this.sb.setTracksByType(t);var r=t.metadata,o=t.metadata.tracks||t.metadata.streams,i={};this.sb.videoTrackId&&(i.video=o[this.sb.videoTrackId-1].track_id),this.sb.audioTrackId&&(i.audio=o[this.sb.audioTrackId-1].track_id),this.doMediaInfo(n({},r,{activeStreams:i})),u.logger.log("%cprocInitSegment:","background: lightpink;",t),this.mediaSource&&!this.mediaSource.sourceBuffers.length&&(this.sb.setMediaSource(this.mediaSource),this.sb.createSourceBuffers(t)),this.sb.createTracks(t.tracks)},e.prototype.doMediaInfo=function e(t){if(u.logger.log("%cmediaInfo:","background: orange;",t),this.onMediaInfo){this.mediaInfo=t;try{this.onMediaInfo(t)}catch(e){console.error(a.errorMsg(e))}}},e.prototype.getVideoTracks=function(){if(this.mediaInfo)return this.mediaInfo.streams.filter(function(e){return e.content===d})},e.prototype.getAudioTracks=function(){if(this.mediaInfo)return this.mediaInfo.streams.filter(function(e){return e.content===m})},e.prototype.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,this.previouslyPaused||(this.playPromise=e.play(),this.playPromise.then(function(){player._pause=!1,player.playing=!0})))},e.prototype.onStartStalling=function(){this.opts.onStartStalling&&this.opts.onStartStalling(),this._stalling=!0,u.logger.log("onStartStalling")},e.prototype.onEndStalling=function(){this.opts.onEndStalling&&this.opts.onEndStalling(),this._stalling=!1,u.logger.log("onEndStalling")},e.prototype.startProgressTimer=function(){this.timer=setInterval(this.onTimer.bind(this),this.opts.progressUpdateTime)},e.prototype.endProgressTimer=function(){clearInterval(this.timer),this.timer=void 0},e.prototype.onTimer=function e(){if(this._eos)return u.logger.log("nothing to play");if(this.immediateSwitch&&this.immediateLevelSwitchEnd(),this.sb.lastLoadedUTC!==this.utcPrev&&!this._stalling&&(this.utcPrev=this.sb.lastLoadedUTC,this.onProgress))try{this.onProgress(this.sb.lastLoadedUTC)}catch(e){console.error(a.errorMsg(e))}},e.prototype.onMediaSourceEnded=function(){u.logger.log("media source ended");try{this.opts.onEOS&&this.opts.onEOS()}catch(e){console.error("error while proccessing onEOS")}},e.prototype.onMediaSourceClose=function(){u.logger.log("media source closed")},e}();t.default=y,e.exports=t.default},function(e,t,r){r(19),e.exports=r(1).Array.find},function(e,t,r){"use strict";var n=r(20),o=r(32)(5),i="find",s=!0;i in[]&&Array(1)[i](function(){s=!1}),n(n.P+n.F*s,"Array",{find:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),r(41)(i)},function(e,t,r){var n=r(0),o=r(1),i=r(4),s=r(27),a=r(10),u="prototype",c=function(e,t,r){var h,f,l,p,d=e&c.F,m=e&c.G,g=e&c.S,v=e&c.P,y=e&c.B,S=m?n:g?n[t]||(n[t]={}):(n[t]||{})[u],E=m?o:o[t]||(o[t]={}),b=E[u]||(E[u]={});for(h in m&&(r=t),r)l=((f=!d&&S&&void 0!==S[h])?S:r)[h],p=y&&f?a(l,n):v&&"function"==typeof l?a(Function.call,l):l,S&&s(S,h,l,e&c.U),E[h]!=l&&i(E,h,p),v&&b[h]!=l&&(b[h]=l)};n.core=o,c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},function(e,t,r){var n=r(22),o=r(23),i=r(25),s=Object.defineProperty;t.f=r(5)?Object.defineProperty:function(e,t,r){if(n(e),t=i(t,!0),n(r),o)try{return s(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){var n=r(2);e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},function(e,t,r){e.exports=!r(5)&&!r(7)(function(){return 7!=Object.defineProperty(r(24)("div"),"a",{get:function(){return 7}}).a})},function(e,t,r){var n=r(2),o=r(0).document,i=n(o)&&n(o.createElement);e.exports=function(e){return i?o.createElement(e):{}}},function(e,t,r){var n=r(2);e.exports=function(e,t){if(!n(e))return e;var r,o;if(t&&"function"==typeof(r=e.toString)&&!n(o=r.call(e)))return o;if("function"==typeof(r=e.valueOf)&&!n(o=r.call(e)))return o;if(!t&&"function"==typeof(r=e.toString)&&!n(o=r.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){var n=r(0),o=r(4),i=r(28),s=r(8)("src"),a=r(29),u="toString",c=(""+a).split(u);r(1).inspectSource=function(e){return a.call(e)},(e.exports=function(e,t,r,a){var u="function"==typeof r;u&&(i(r,"name")||o(r,"name",t)),e[t]!==r&&(u&&(i(r,s)||o(r,s,e[t]?""+e[t]:c.join(String(t)))),e===n?e[t]=r:a?e[t]?e[t]=r:o(e,t,r):(delete e[t],o(e,t,r)))})(Function.prototype,u,function(){return"function"==typeof this&&this[s]||a.call(this)})},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t,r){e.exports=r(9)("native-function-to-string",Function.toString)},function(e,t){e.exports=!1},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,r){var n=r(10),o=r(33),i=r(34),s=r(36),a=r(38);e.exports=function(e,t){var r=1==e,u=2==e,c=3==e,h=4==e,f=6==e,l=5==e||f,p=t||a;return function(t,a,d){for(var m,g,v=i(t),y=o(v),S=n(a,d,3),E=s(y.length),b=0,_=r?p(t,E):u?p(t,0):void 0;E>b;b++)if((l||b in y)&&(g=S(m=y[b],b,v),e))if(r)_[b]=g;else if(g)switch(e){case 3:return!0;case 5:return m;case 6:return b;case 2:_.push(m)}else if(h)return!1;return f?-1:c||h?h:_}}},function(e,t,r){var n=r(11);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},function(e,t,r){var n=r(35);e.exports=function(e){return Object(n(e))}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,r){var n=r(37),o=Math.min;e.exports=function(e){return e>0?o(n(e),9007199254740991):0}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},function(e,t,r){var n=r(39);e.exports=function(e,t){return new(n(e))(t)}},function(e,t,r){var n=r(2),o=r(40),i=r(12)("species");e.exports=function(e){var t;return o(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!o(t.prototype)||(t=void 0),n(t)&&null===(t=t[i])&&(t=void 0)),void 0===t?Array:t}},function(e,t,r){var n=r(11);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,r){var n=r(12)("unscopables"),o=Array.prototype;null==o[n]&&r(4)(o,n,{}),e.exports=function(e){o[n][e]=!0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWSURL=c;var n=s(r(43)),o=s(r(6)),i=r(3);function s(e){return e&&e.__esModule?e:{default:e}}var a="live",u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.opts=t,this.init(),this.onwso=this.open.bind(this),this.onwsm=this.handleReceiveMessage.bind(this),this.onwse=this.handleError.bind(this)}return e.prototype.init=function(){this.opened=!1,this.connectionPromise=void 0},e.prototype.start=function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return this.connectionPromise=new Promise(function(s,a){var u=c(e,t,n,i);r.websocket=new WebSocket(u),r.websocket.binaryType="arraybuffer",r.websocket.addEventListener(o.default.WS_OPEN,r.onwso),r.websocket.addEventListener(o.default.WS_MESSAGE,r.onwsm),r.websocket.addEventListener(o.default.WS_ERROR,r.onwse),r._openingResolve=s,r._openingReject=a}),this.connectionPromise},e.prototype.open=function(){this.opened=!0,this._openingResolve(),this.resume(),this.websocket.removeEventListener(o.default.WS_OPEN,this.onwso)},e.prototype.send=function(e){this.websocket.send(e)},e.prototype.resume=function(){i.logger.log("ws: send resume"),this.websocket.send("resume")},e.prototype.pause=function(){i.logger.log("ws: send pause"),1===this.websocket.readyState&&this.websocket.send("pause")},e.prototype.seek=function(e){var t=e===a?"":"play_from=";i.logger.log(""+t+e),this.websocket.send(""+t+e)},e.prototype.setTracks=function(e,t){this.websocket.send("set_tracks="+e+t)},e.prototype.handleReceiveMessage=function(e){this.opts.message(e)},e.prototype.handleError=function(){var e;this.opts.error&&(e=this.opts).error.apply(e,arguments)},e.prototype.destroy=function(){this.websocket&&(this.pause(),this.websocket.removeEventListener(o.default.WS_MESSAGE,this.onwsm),this.websocket.onclose=function(){},this.websocket.close(),this.init())},e}();function c(e,t,r,o){var s=t;if(!s&&!r&&!o)return e;var u=(0,n.default)({url:e}),c="";u.query&&(c=u.query.split("&").map(function(e){return e.split("=")}).filter(function(e){return"from"!==e[0]&&"tracks"!==e[0]}).map(function(e){return e.join("=")}).join("&"),i.logger.log(c));var h=!!r||!!o;return u.protocol+"//"+u.host+u.pathname+"?"+(h?"tracks="+r+o:"")+(h&&s&&s!==a?"&":"")+(t===a?"":"from="+Math.floor(s))+((h||s&&s!==a)&&c?"&":"")+c}t.default=u},function(e,t,r){"use strict";
/*!
 * parseurl
 * Copyright(c) 2014 Jonathan Ong
 * Copyright(c) 2014-2017 Douglas Christopher Wilson
 * MIT Licensed
 */var n=r(44),o=n.parse,i=n.Url;function s(e){var t=e.url;if(void 0!==t){var r=e._parsedUrl;return u(t,r)?r:((r=a(t))._raw=t,e._parsedUrl=r)}}function a(e){if("string"!=typeof e||47!==e.charCodeAt(0))return o(e);for(var t=e,r=null,n=null,s=1;s<e.length;s++)switch(e.charCodeAt(s)){case 63:null===n&&(t=e.substring(0,s),r=e.substring(s+1),n=e.substring(s));break;case 9:case 10:case 12:case 13:case 32:case 35:case 160:case 65279:return o(e)}var a=void 0!==i?new i:{};return a.path=e,a.href=e,a.pathname=t,a.query=r,a.search=n,a}function u(e,t){return"object"==typeof t&&null!==t&&(void 0===i||t instanceof i)&&t._raw===e}e.exports=s,e.exports.original=function(e){var t=e.originalUrl;if("string"!=typeof t)return s(e);var r=e._parsedOriginalUrl;if(u(t,r))return r;return(r=a(t))._raw=t,e._parsedOriginalUrl=r}},function(e,t,r){"use strict";var n=r(45),o=r(48);function i(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=S,t.resolve=function(e,t){return S(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?S(e,!1,!0).resolveObject(t):t},t.format=function(e){o.isString(e)&&(e=S(e));return e instanceof i?e.format():i.prototype.format.call(e)},t.Url=i;var s=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,u=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),h=["'"].concat(c),f=["%","/","?",";","#"].concat(h),l=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,d=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},v={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=r(49);function S(e,t,r){if(e&&o.isObject(e)&&e instanceof i)return e;var n=new i;return n.parse(e,t,r),n}i.prototype.parse=function(e,t,r){if(!o.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var i=e.indexOf("?"),a=-1!==i&&i<e.indexOf("#")?"?":"#",c=e.split(a);c[0]=c[0].replace(/\\/g,"/");var S=e=c.join(a);if(S=S.trim(),!r&&1===e.split("#").length){var E=u.exec(S);if(E)return this.path=S,this.href=S,this.pathname=E[1],E[2]?(this.search=E[2],this.query=t?y.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var b=s.exec(S);if(b){var _=(b=b[0]).toLowerCase();this.protocol=_,S=S.substr(b.length)}if(r||b||S.match(/^\/\/[^@\/]+@[^@\/]+/)){var w="//"===S.substr(0,2);!w||b&&g[b]||(S=S.substr(2),this.slashes=!0)}if(!g[b]&&(w||b&&!v[b])){for(var O,M,T=-1,k=0;k<l.length;k++){-1!==(A=S.indexOf(l[k]))&&(-1===T||A<T)&&(T=A)}-1!==(M=-1===T?S.lastIndexOf("@"):S.lastIndexOf("@",T))&&(O=S.slice(0,M),S=S.slice(M+1),this.auth=decodeURIComponent(O)),T=-1;for(k=0;k<f.length;k++){var A;-1!==(A=S.indexOf(f[k]))&&(-1===T||A<T)&&(T=A)}-1===T&&(T=S.length),this.host=S.slice(0,T),S=S.slice(T),this.parseHost(),this.hostname=this.hostname||"";var I="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!I)for(var j=this.hostname.split(/\./),P=(k=0,j.length);k<P;k++){var x=j[k];if(x&&!x.match(p)){for(var U="",R=0,C=x.length;R<C;R++)x.charCodeAt(R)>127?U+="x":U+=x[R];if(!U.match(p)){var B=j.slice(0,k),D=j.slice(k+1),L=x.match(d);L&&(B.push(L[1]),D.unshift(L[2])),D.length&&(S="/"+D.join(".")+S),this.hostname=B.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),I||(this.hostname=n.toASCII(this.hostname));var N=this.port?":"+this.port:"",F=this.hostname||"";this.host=F+N,this.href+=this.host,I&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==S[0]&&(S="/"+S))}if(!m[_])for(k=0,P=h.length;k<P;k++){var q=h[k];if(-1!==S.indexOf(q)){var W=encodeURIComponent(q);W===q&&(W=escape(q)),S=S.split(q).join(W)}}var G=S.indexOf("#");-1!==G&&(this.hash=S.substr(G),S=S.slice(0,G));var V=S.indexOf("?");if(-1!==V?(this.search=S.substr(V),this.query=S.substr(V+1),t&&(this.query=y.parse(this.query)),S=S.slice(0,V)):t&&(this.search="",this.query={}),S&&(this.pathname=S),v[_]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){N=this.pathname||"";var H=this.search||"";this.path=N+H}return this.href=this.format(),this},i.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",i=!1,s="";this.host?i=e+this.host:this.hostname&&(i=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&o.isObject(this.query)&&Object.keys(this.query).length&&(s=y.stringify(this.query));var a=this.search||s&&"?"+s||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||v[t])&&!1!==i?(i="//"+(i||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):i||(i=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),t+i+(r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(a=a.replace("#","%23"))+n},i.prototype.resolve=function(e){return this.resolveObject(S(e,!1,!0)).format()},i.prototype.resolveObject=function(e){if(o.isString(e)){var t=new i;t.parse(e,!1,!0),e=t}for(var r=new i,n=Object.keys(this),s=0;s<n.length;s++){var a=n[s];r[a]=this[a]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var u=Object.keys(e),c=0;c<u.length;c++){var h=u[c];"protocol"!==h&&(r[h]=e[h])}return v[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!v[e.protocol]){for(var f=Object.keys(e),l=0;l<f.length;l++){var p=f[l];r[p]=e[p]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||g[e.protocol])r.pathname=e.pathname;else{for(var d=(e.pathname||"").split("/");d.length&&!(e.host=d.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),r.pathname=d.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var m=r.pathname||"",y=r.search||"";r.path=m+y}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var S=r.pathname&&"/"===r.pathname.charAt(0),E=e.host||e.pathname&&"/"===e.pathname.charAt(0),b=E||S||r.host&&e.pathname,_=b,w=r.pathname&&r.pathname.split("/")||[],O=(d=e.pathname&&e.pathname.split("/")||[],r.protocol&&!v[r.protocol]);if(O&&(r.hostname="",r.port=null,r.host&&(""===w[0]?w[0]=r.host:w.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===d[0]?d[0]=e.host:d.unshift(e.host)),e.host=null),b=b&&(""===d[0]||""===w[0])),E)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,w=d;else if(d.length)w||(w=[]),w.pop(),w=w.concat(d),r.search=e.search,r.query=e.query;else if(!o.isNullOrUndefined(e.search)){if(O)r.hostname=r.host=w.shift(),(I=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=I.shift(),r.host=r.hostname=I.shift());return r.search=e.search,r.query=e.query,o.isNull(r.pathname)&&o.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!w.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var M=w.slice(-1)[0],T=(r.host||e.host||w.length>1)&&("."===M||".."===M)||""===M,k=0,A=w.length;A>=0;A--)"."===(M=w[A])?w.splice(A,1):".."===M?(w.splice(A,1),k++):k&&(w.splice(A,1),k--);if(!b&&!_)for(;k--;k)w.unshift("..");!b||""===w[0]||w[0]&&"/"===w[0].charAt(0)||w.unshift(""),T&&"/"!==w.join("/").substr(-1)&&w.push("");var I,j=""===w[0]||w[0]&&"/"===w[0].charAt(0);O&&(r.hostname=r.host=j?"":w.length?w.shift():"",(I=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=I.shift(),r.host=r.hostname=I.shift()));return(b=b||r.host&&w.length)&&!j&&w.unshift(""),w.length?r.pathname=w.join("/"):(r.pathname=null,r.path=null),o.isNull(r.pathname)&&o.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},i.prototype.parseHost=function(){var e=this.host,t=a.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,t,r){(function(e,n){var o;/*! https://mths.be/punycode v1.4.1 by @mathias */ /*! https://mths.be/punycode v1.4.1 by @mathias */!function(i){t&&t.nodeType,e&&e.nodeType;var s="object"==typeof n&&n;s.global!==s&&s.window!==s&&s.self;var a,u=2147483647,c=36,h=1,f=26,l=38,p=700,d=72,m=128,g="-",v=/^xn--/,y=/[^\x20-\x7E]/,S=/[\x2E\u3002\uFF0E\uFF61]/g,E={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},b=c-h,_=Math.floor,w=String.fromCharCode;function O(e){throw new RangeError(E[e])}function M(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function T(e,t){var r=e.split("@"),n="";return r.length>1&&(n=r[0]+"@",e=r[1]),n+M((e=e.replace(S,".")).split("."),t).join(".")}function k(e){for(var t,r,n=[],o=0,i=e.length;o<i;)(t=e.charCodeAt(o++))>=55296&&t<=56319&&o<i?56320==(64512&(r=e.charCodeAt(o++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),o--):n.push(t);return n}function A(e){return M(e,function(e){var t="";return e>65535&&(t+=w((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=w(e)}).join("")}function I(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:c}function j(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function P(e,t,r){var n=0;for(e=r?_(e/p):e>>1,e+=_(e/t);e>b*f>>1;n+=c)e=_(e/b);return _(n+(b+1)*e/(e+l))}function x(e){var t,r,n,o,i,s,a,l,p,v,y=[],S=e.length,E=0,b=m,w=d;for((r=e.lastIndexOf(g))<0&&(r=0),n=0;n<r;++n)e.charCodeAt(n)>=128&&O("not-basic"),y.push(e.charCodeAt(n));for(o=r>0?r+1:0;o<S;){for(i=E,s=1,a=c;o>=S&&O("invalid-input"),((l=I(e.charCodeAt(o++)))>=c||l>_((u-E)/s))&&O("overflow"),E+=l*s,!(l<(p=a<=w?h:a>=w+f?f:a-w));a+=c)s>_(u/(v=c-p))&&O("overflow"),s*=v;w=P(E-i,t=y.length+1,0==i),_(E/t)>u-b&&O("overflow"),b+=_(E/t),E%=t,y.splice(E++,0,b)}return A(y)}function U(e){var t,r,n,o,i,s,a,l,p,v,y,S,E,b,M,T=[];for(S=(e=k(e)).length,t=m,r=0,i=d,s=0;s<S;++s)(y=e[s])<128&&T.push(w(y));for(n=o=T.length,o&&T.push(g);n<S;){for(a=u,s=0;s<S;++s)(y=e[s])>=t&&y<a&&(a=y);for(a-t>_((u-r)/(E=n+1))&&O("overflow"),r+=(a-t)*E,t=a,s=0;s<S;++s)if((y=e[s])<t&&++r>u&&O("overflow"),y==t){for(l=r,p=c;!(l<(v=p<=i?h:p>=i+f?f:p-i));p+=c)M=l-v,b=c-v,T.push(w(j(v+M%b,0))),l=_(M/b);T.push(w(j(l,0))),i=P(r,E,n==o),r=0,++n}++r,++t}return T.join("")}a={version:"1.4.1",ucs2:{decode:k,encode:A},decode:x,encode:U,toASCII:function(e){return T(e,function(e){return y.test(e)?"xn--"+U(e):e})},toUnicode:function(e){return T(e,function(e){return v.test(e)?x(e.slice(4).toLowerCase()):e})}},void 0===(o=function(){return a}.call(t,r,t,e))||(e.exports=o)}()}).call(this,r(46)(e),r(47))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,r){"use strict";t.decode=t.parse=r(50),t.encode=t.stringify=r(51)},function(e,t,r){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,r,i){t=t||"&",r=r||"=";var s={};if("string"!=typeof e||0===e.length)return s;var a=/\+/g;e=e.split(t);var u=1e3;i&&"number"==typeof i.maxKeys&&(u=i.maxKeys);var c=e.length;u>0&&c>u&&(c=u);for(var h=0;h<c;++h){var f,l,p,d,m=e[h].replace(a,"%20"),g=m.indexOf(r);g>=0?(f=m.substr(0,g),l=m.substr(g+1)):(f=m,l=""),p=decodeURIComponent(f),d=decodeURIComponent(l),n(s,p)?o(s[p])?s[p].push(d):s[p]=[s[p],d]:s[p]=d}return s};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,r){"use strict";var n=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,r,a){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?i(s(e),function(s){var a=encodeURIComponent(n(s))+r;return o(e[s])?i(e[s],function(e){return a+encodeURIComponent(n(e))}).join(t):a+encodeURIComponent(n(e[s]))}).join(t):a?encodeURIComponent(n(a))+r+encodeURIComponent(n(e)):""};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function i(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var s=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSelfScope=function(){return"undefined"==typeof window?self:window}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(13),o=r(3),i=r(14),s=r(6);var a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o.logger.log("create BuffersController"),this.media=t.media,this.init(t),this.doArrayBuffer=n.doArrayBuffer.bind(this),this.maybeAppend=this.maybeAppend.bind(this),this.onSBUpdateEnd=this.onSBUpdateEnd.bind(this)}return e.prototype.init=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.flushRange=[],this.appended=0,this.mediaSource=e.mediaSource,this.segments=[],this.sourceBuffer={}},e.prototype.setMediaSource=function(e){this.mediaSource=e},e.prototype.createSourceBuffers=function(e){var t=this,r=this.sourceBuffer;e.tracks.forEach(function(e){var n=e.content===i.VIDEO?'video/mp4; codecs="avc1.4d401f"':'audio/mp4; codecs="mp4a.40.2"';r[e.content]=t.mediaSource.addSourceBuffer(n),r[e.content].addEventListener(s.BUFFER_UPDATE_END,t.onSBUpdateEnd)})},e.prototype.onSBUpdateEnd=function(){this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),!this._needsFlush&&this.segments.length&&this.doArrayBuffer()},e.prototype.createTracks=function(e){var t=this;e.forEach(function(e){var r=(0,n.base64ToArrayBuffer)(e.payload),o={type:t.getTypeBytrackId(e.id),isInit:!0,data:r};t.maybeAppend(o)})},e.prototype.maybeAppend=function(e){if(this._needsFlush)this.segments.unshift(e);else{var t=this.sourceBuffer[e.type];t.updating?this.segments.unshift(e):(t.appendBuffer(e.data),this.appended++)}},e.prototype.setTracksByType=function(e){var t=this;e.tracks.forEach(function(e){t[e.content===i.VIDEO?"videoTrackId":"audioTrackId"]=e.id})},e.prototype.getTypeBytrackId=function(e){return this.audioTrackId===e?i.AUDIO:i.VIDEO},e.prototype.procArrayBuffer=function(e){var t=this.rawDataToSegmnet(e);this.segments.push(t),this.doArrayBuffer()},e.prototype.seek=function(){for(var e in this.sourceBuffer)this.sourceBuffer[e].abort(),this.sourceBuffer[e].mode="sequence";this.segments=[]},e.prototype.isBuffered=function(){var e=0,t=this.sourceBuffer;for(var r in t)e+=t[r].buffered.length;return e>0},e.prototype.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,r=this.sourceBuffer;try{for(var n in r)t+=r[n].buffered.length}catch(e){console.error("error while accessing sourceBuffer.buffered")}this.appended=t,this._setTracksFlag=!1}},e.prototype.flushBuffer=function(e,t,r){var n=void 0,i=void 0,s=void 0,a=void 0,u=void 0,c=void 0,h=this.sourceBuffer;if(Object.keys(h).length){if(o.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(var f in h)if(!r||f===r){if((n=h[f]).ended=!1,n.updating)return o.logger.warn("cannot flush, sb updating in progress"),!1;try{for(i=0;i<n.buffered.length;i++)if(s=n.buffered.start(i),a=n.buffered.end(i),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&t===Number.POSITIVE_INFINITY?(u=e,c=t):(u=Math.max(s,e),c=Math.min(a,t)),Math.min(c,a)-u>.5)return this.flushBufferCounter++,o.logger.log("flush "+f+" ["+u+","+c+"], of ["+s+","+a+"], pos:"+this.media.currentTime),n.remove(u,c),!1}catch(e){o.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else o.logger.warn("abort flushing too many retries");o.logger.log("buffer flushed")}return!0},e.prototype.rawDataToSegmnet=function(e){var t=(0,n.RawDataToUint8Array)(e),r=(0,n.getTrackId)(t);return{type:this.getTypeBytrackId(r),data:t}},e.prototype.onBufferEos=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.sourceBuffer,r=e.type;for(var n in t)r&&n!==r||t[n].ended||(t[n].ended=!0,o.logger.log(n+" sourceBuffer now EOS"));this.checkEos()},e.prototype.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var r in e){var n=e[r];if(!n.ended)return;if(n.updating)return void(this._needsEos=!0)}o.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){o.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},e.prototype.destroy=function(){this.init()},e}();t.default=a,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EVENT_SEGMENT="event",t.MSE_INIT_SEGMENT="mse_init_segment",t.MSE_MEDIA_SEGMENT="mse_media_segment"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={NOT_HTML_MEDIA_ELEMENT:"media should be an HTMLMediaElement instance"},e.exports=t.default}])});